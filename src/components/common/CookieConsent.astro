---
/* src/components/common/CookieConsent.astro */
---

<div id="cookie-banner" class="fixed bottom-0 left-0 w-full bg-[#212529] text-white p-4 z-[9999] hidden border-t border-gray-700 shadow-2xl">
  <div class="max-w-6xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-center sm:text-left">
    <div class="text-sm text-gray-300">
      <span class="font-bold text-white">We value your privacy.</span> 
      We use cookies to improve your experience and analyze website traffic. 
      By clicking "Accept", you agree to our use of cookies.
    </div>
    <div class="flex gap-3">
      <button id="cookie-accept" class="bg-[#00A79D] hover:bg-[#008f87] text-white font-bold py-2.5 px-6 rounded-full transition duration-200 shadow-lg cursor-pointer">
        Accept
      </button>
    </div>
  </div>
</div>

<script is:inline>
  /* --- CONFIGURATION --- */
  const GA_MEASUREMENT_ID = 'G-4RZ1V007T3'; // <--- Google Analytics ID

  /* --- LOGIC --- */
  function loadGoogleAnalytics() {
    // Prevent double loading
    if (document.getElementById('ga-script')) return;

    // 1. Create the script tag
    const script = document.createElement('script');
    script.id = 'ga-script';
    script.async = true;
    script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`;
    document.head.appendChild(script);

    // 2. Initialize DataLayer
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', GA_MEASUREMENT_ID);
    
    console.log('UXHM: Analytics Loaded');
  }

  // Check LocalStorage on page load
  const consent = localStorage.getItem('uxhm-cookie-consent');
  const banner = document.getElementById('cookie-banner');
  const acceptBtn = document.getElementById('cookie-accept');

  if (consent === 'true') {
    // If they already said yes, load GA immediately
    loadGoogleAnalytics();
  } else {
    // If no consent yet, show the banner
    banner.classList.remove('hidden');
  }

  // Handle the Click
  if (acceptBtn) {
    acceptBtn.addEventListener('click', () => {
      // 1. Save consent
      localStorage.setItem('uxhm-cookie-consent', 'true');
      // 2. Hide banner
      banner.classList.add('hidden');
      // 3. Start the script
      loadGoogleAnalytics();
    });
  }
</script>